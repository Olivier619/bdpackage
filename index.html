<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BD Creator - Créez des bandes dessinées avec l'IA</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary-color: #2196F3;
            --secondary-color: #FF9800;
            --dark-color: #333;
            --light-color: #f4f4f4;
            --danger-color: #dc3545;
            --success-color: #28a745;
            --disabled-color: #ccc;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background-color: #f8f9fa;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            display: flex;
            align-items: center;
        }

        .logo i {
            margin-right: 10px;
            font-size: 2rem;
        }

        nav ul {
            display: flex;
            list-style: none;
        }

        nav ul li {
            margin-left: 20px;
        }

        nav ul li a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }

        nav ul li a:hover {
            color: var(--secondary-color);
        }

        .hero {
            background: linear-gradient(135deg, var(--primary-color) 0%, #64b5f6 100%);
            color: white;
            padding: 4rem 0;
            text-align: center;
        }

        .hero h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .hero p {
            font-size: 1.2rem;
            max-width: 800px;
            margin: 0 auto 2rem;
        }

        .btn {
            display: inline-block;
            background: var(--secondary-color);
            color: white;
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.3s, transform 0.2s;
            text-decoration: none;
            font-weight: 500;
        }

        .btn:hover {
            background: #e68a00;
            transform: translateY(-2px);
        }

        .btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-primary {
            background: var(--primary-color);
        }

        .btn-primary:hover {
            background: #0b7dda;
        }
        .btn-primary:disabled {
             background-color: #a0cff8;
        }
        .btn-success { background-color: var(--success-color); }
        .btn-danger { background-color: var(--danger-color); }
        .btn-sm { padding: 0.4rem 0.8rem; font-size: 0.9rem; }
        .btn-secondary { background-color: #6c757d; }
        .btn-secondary:hover { background-color: #5a6268; }


        .features {
            padding: 4rem 0;
            background-color: white;
        }

        .section-title {
            text-align: center;
            margin-bottom: 3rem;
        }

        .section-title h2 {
            font-size: 2rem;
            color: var(--dark-color);
            margin-bottom: 1rem;
        }

        .section-title p {
            color: #666;
            max-width: 800px;
            margin: 0 auto;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }

        .feature-card {
            background: white;
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            text-align: center;
        }

        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }

        .feature-card i {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 1.5rem;
        }

        .feature-card h3 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--dark-color);
        }

        .feature-card p {
            color: #666;
        }

        .how-it-works {
            padding: 4rem 0;
            background-color: #f8f9fa;
        }

        .steps {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 2rem;
            margin-top: 3rem;
        }

        .step {
            flex: 1;
            min-width: 250px;
            max-width: 350px;
            text-align: center;
            position: relative;
        }

        .step-number {
            width: 50px;
            height: 50px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            font-weight: bold;
            margin: 0 auto 1.5rem;
        }

        .step h3 {
            margin-bottom: 1rem;
            color: var(--dark-color);
        }

        .step p {
            color: #666;
        }

        .app {
            padding: 4rem 0;
            background-color: white;
        }

        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 2rem;
            border-bottom: 1px solid #ddd;
            padding-bottom: 1rem;
            flex-wrap: wrap; /* Allow wrapping on small screens */
        }

        .tab-btn {
            background: none;
            border: none;
            padding: 0.8rem 1.5rem;
            margin: 0 0.5rem 0.5rem 0.5rem; /* Added bottom margin for wrap */
            font-size: 1rem;
            cursor: pointer;
            border-radius: 5px 5px 0 0;
            transition: background 0.3s, color 0.3s;
            font-weight: 500;
        }

        .tab-btn.active {
            background-color: var(--primary-color);
            color: white;
        }

        .tab-content {
            display: none;
            padding: 2rem;
            background: white;
            border-radius: 0 0 8px 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            min-height: 200px; /* Give tabs some minimum height */
        }

        .tab-content.active {
            display: block;
        }

        .input-group {
            margin-bottom: 1.5rem;
        }

        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .input-group input,
        .input-group textarea,
        .input-group select { /* Added select */
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            font-family: inherit; /* Ensure select uses body font */
        }

        .input-group textarea {
            min-height: 80px; /* Use min-height */
            resize: vertical;
        }

        footer {
            background-color: var(--dark-color);
            color: white;
            padding: 2rem 0;
            text-align: center;
        }

        footer p {
            margin-bottom: 1rem;
        }

        .social-links {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .social-links a {
            color: white;
            font-size: 1.5rem;
            transition: color 0.3s;
        }

        .social-links a:hover {
            color: var(--secondary-color);
        }

        .footer-links {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 1.5rem;
            margin-bottom: 1rem;
        }

        .footer-links a {
            color: #ddd;
            text-decoration: none;
            transition: color 0.3s;
        }

        .footer-links a:hover {
            color: var(--secondary-color);
        }

        /* Styles spécifiques pour l'application */
         .scenario-section, .scenario-chapter, .storyboard-page, .prompt-item {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
         }
         .scenario-page {
            margin-left: 20px;
            border-left: 2px solid #eee;
            padding-left: 15px;
            margin-top: 10px;
         }
         .scenario-panel {
             margin-left: 20px;
             margin-bottom: 5px;
         }
        .scenario-chapter h4, .storyboard-page h4, .prompt-item h4 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }
         .scenario-page h5, .storyboard-panel-display h5 {
             color: var(--secondary-color);
             margin-bottom: 8px;
         }
         .prompt-item h5 {
             color: var(--success-color);
             margin-bottom: 8px;
         }

        .storyboard-page { border-left-color: var(--secondary-color); }
        .prompt-item { border-left-color: var(--success-color); }

        .prompt-item pre {
            background-color: #333;
            color: white;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            margin-top: 10px;
            white-space: pre-wrap; /* Wrap long lines */
            word-break: break-all; /* Break long words/URLs */
        }

        .session-controls {
            display: flex;
            flex-wrap: wrap; /* Allow wrapping */
            gap: 10px;
            margin-bottom: 20px;
        }

        .session-controls button {
            flex: 1 1 auto; /* Allow buttons to shrink/grow */
             min-width: 150px; /* Prevent buttons getting too small */
        }

        #loading-indicator {
            display: none;
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 8px;
        }

        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: var(--primary-color);
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Styles from previous version, adapted */
        .app-controls {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #eee;
            display: none; /* Hidden by default */
            gap: 10px;
             flex-wrap: wrap;
        }
        .app-controls button {
            margin-right: 10px;
             margin-bottom: 10px; /* Spacing when wrapped */
        }
        .modification-area {
            margin-top: 1rem;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f8f9fa;
            display: none; /* Hidden by default */
        }
        .modification-area label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        .modification-area textarea {
            width: 100%;
            min-height: 80px;
            margin-bottom: 0.5rem;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        .tab-btn.disabled {
            color: var(--disabled-color);
            cursor: not-allowed;
            background: #eee;
        }
         .chapter-selector {
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
         }
         .chapter-selector label {
             margin-bottom: 0; /* Remove default margin */
             font-weight: 500;
         }
         .chapter-selector select {
             flex-grow: 1; /* Allow select to take available space */
             max-width: 400px; /* Limit max width */
         }
        .storyboard-panel-display {
            border: 1px solid #eee;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
            background-color: #fafafa;
        }
         .storyboard-panel-details p {
            margin-bottom: 5px;
         }
         .storyboard-visual-placeholder {
             border: 1px dashed #ccc;
             min-height: 100px;
             display: flex;
             align-items: center;
             justify-content: center;
             color: #aaa;
             font-style: italic;
             margin-bottom: 10px;
             background-color: #f0f0f0;
             border-radius: 4px;
             padding: 10px;
             text-align: center;
         }
         .progress-indicator {
             display: flex;
             justify-content: space-around;
             margin-bottom: 2rem;
             padding: 1rem;
             background-color: #e9ecef;
             border-radius: 5px;
             flex-wrap: wrap; /* Allow wrapping */
             gap: 10px; /* Add gap for wrapped items */
         }
         .progress-step {
             text-align: center;
             color: #adb5bd;
             flex: 1; /* Distribute space */
             min-width: 80px; /* Prevent shrinking too much */
         }
         .progress-step.active {
             color: var(--primary-color);
             font-weight: bold;
         }
         .progress-step.completed {
             color: var(--success-color);
             font-weight: bold;
         }
         .progress-step .icon {
             display: block;
             font-size: 1.5rem;
             margin-bottom: 0.5rem;
         }
         .input-group-inline {
            display: flex;
            gap: 20px;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
         }
         .input-group-inline .input-group {
            flex: 1;
            min-width: 200px;
            margin-bottom: 0;
         }
         .text-danger {
            color: var(--danger-color);
            font-weight: bold;
         }


         /* Media Queries */
        @media (max-width: 768px) {
            header .container {
                flex-direction: column;
                text-align: center;
            }
            nav ul {
                margin-top: 1rem;
                flex-wrap: wrap; /* Allow nav items to wrap */
                justify-content: center;
            }
            nav ul li {
                 margin-left: 10px; /* Reduce margin */
                 margin-right: 10px;
            }
            .hero h1 { font-size: 2rem; }
            .hero p { font-size: 1rem; }
            .features-grid { grid-template-columns: 1fr; }
            .steps { flex-direction: column; align-items: center; }
            .step { margin-bottom: 2rem; max-width: 90%; }
            .tabs { justify-content: flex-start; }
            .tab-btn { flex-grow: 1; margin-left: 0; margin-right: 0;} /* Make tabs take full width */
             .session-controls { justify-content: center; }
             .input-group-inline { flex-direction: column; gap: 1rem; }
             .chapter-selector { flex-direction: column; align-items: flex-start;}
             .chapter-selector select { max-width: 100%; }
             .progress-indicator { gap: 5px;}
             .progress-step .icon { font-size: 1.2rem;}
        }

    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">
                <i class="fas fa-book-open"></i>
                <span>BD Creator</span>
            </div>
            <nav>
                <ul>
                    <li><a href="#features">Fonctionnalités</a></li>
                    <li><a href="#how-it-works">Comment ça marche</a></li>
                    <li><a href="#app">Créer ma BD</a></li>
                    <li><a href="#" id="login-btn">Connexion</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <section class="hero">
        <div class="container">
            <h1>Créez des bandes dessinées incroyables avec l'IA</h1>
            <p>Transformez vos idées en scénarios complets, storyboards détaillés et prompts optimisés en quelques clics grâce à l'IA côté serveur.</p>
            <a href="#app" class="btn">Commencer maintenant</a>
        </div>
    </section>

    <section class="features" id="features">
        <div class="container">
            <div class="section-title">
                <h2>Fonctionnalités</h2>
                <p>Découvrez les outils puissants qui vous aideront à créer des bandes dessinées professionnelles sans effort, étape par étape.</p>
            </div>
            <div class="features-grid">
                 <div class="feature-card">
                    <i class="fas fa-lightbulb"></i>
                    <h3>Idée Initiale & Options</h3>
                    <p>Définissez votre idée, choisissez le genre, le style visuel et le ton pour guider l'IA.</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-server"></i> <!-- Changed icon -->
                    <h3>Génération Scénario via API</h3>
                    <p>Obtenez un scénario structuré (page/case) généré par une IA puissante côté serveur. Validez ou demandez des modifications.</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-pencil-alt"></i>
                    <h3>Storyboard Assisté (Bientôt)</h3>
                    <p>Visualisez votre histoire avec des suggestions de cadrage et de composition pour chaque case. Approuvez chapitre par chapitre.</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-image"></i>
                    <h3>Prompts Optimisés (Bientôt)</h3>
                    <p>Générez des prompts en anglais prêts à l'emploi pour Midjourney/Dall-E, basés sur votre storyboard et style.</p>
                </div>
                 <div class="feature-card">
                    <i class="fas fa-tasks"></i>
                    <h3>Workflow Guidé</h3>
                    <p>Suivez un processus étape par étape avec des validations pour garder le contrôle créatif total.</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-save"></i>
                    <h3>Sauvegarde de Sessions</h3>
                    <p>Sauvegardez votre progression à tout moment et reprenez votre projet de BD plus tard.</p>
                </div>
            </div>
        </div>
    </section>

    <section class="how-it-works" id="how-it-works">
        <div class="container">
            <div class="section-title">
                <h2>Comment ça marche</h2>
                <p>Suivez ces étapes simples pour créer votre bande dessinée avec l'aide de l'IA.</p>
            </div>
            <div class="steps">
                <div class="step">
                    <div class="step-number">1</div>
                    <h3>Décrivez votre idée</h3>
                    <p>Entrez des mots-clés ou une description. Choisissez le genre, le style visuel et le ton.</p>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <h3>Générez & Validez le Scénario</h3>
                    <p>L'IA côté serveur crée un scénario structuré. Lisez-le, demandez des modifications si besoin, puis approuvez.</p>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <h3>Approuvez le Storyboard (Bientôt)</h3>
                    <p>Pour chaque chapitre, visualisez le storyboard avec suggestions de cadrage/composition. Approuvez.</p>
                </div>
                <div class="step">
                    <div class="step-number">4</div>
                    <h3>Obtenez les Prompts (Bientôt)</h3>
                    <p>Recevez les prompts optimisés pour chaque case du chapitre approuvé. Copiez et créez !</p>
                </div>
            </div>
        </div>
    </section>

    <section class="app" id="app">
        <div class="container">
            <div class="section-title">
                <h2>Créez votre BD maintenant</h2>
                <p>Utilisez notre application pour transformer vos idées en bandes dessinées complètes.</p>
            </div>

            <div class="session-controls">
                <button class="btn" id="new-session">Nouvelle session</button>
                <button class="btn" id="save-session">Sauvegarder la session</button>
                <button class="btn" id="load-session">Charger une session</button>
            </div>

            <!-- Progress Indicator -->
             <div class="progress-indicator">
                <div class="progress-step active" id="step-idea">
                    <span class="icon"><i class="fas fa-lightbulb"></i></span> Idée
                </div>
                <div class="progress-step" id="step-scenario">
                    <span class="icon"><i class="fas fa-file-alt"></i></span> Scénario
                </div>
                <div class="progress-step" id="step-storyboard">
                     <span class="icon"><i class="fas fa-border-all"></i></span> Storyboard
                </div>
                <div class="progress-step" id="step-prompts">
                    <span class="icon"><i class="fas fa-magic"></i></span> Prompts
                </div>
            </div>

            <div class="tabs">
                <button class="tab-btn active" data-tab="home">1. Idée & Options</button>
                <button class="tab-btn disabled" data-tab="scenario">2. Scénario</button>
                <button class="tab-btn disabled" data-tab="storyboard">3. Storyboard</button>
                <button class="tab-btn disabled" data-tab="prompts">4. Prompts</button>
            </div>

            <!-- Tab 1: Home / Idea Input -->
            <div class="tab-content active" id="home-content">
                <h3>Entrez les détails de votre projet</h3>
                <p>Commencez par décrire votre idée et choisissez les options pour guider l'IA.</p>

                <div class="input-group">
                    <label for="keywords">Idée initiale (mots-clés, phrase, ou courte histoire)</label>
                    <textarea id="keywords" placeholder="Ex: Aventure spatiale avec des chats pirates cherchant une planète de thon légendaire." rows="3"></textarea>
                </div>

                <div class="input-group-inline">
                     <div class="input-group">
                        <label for="genre">Genre</label>
                        <select id="genre">
                            <option value="Fantastique">Fantastique</option>
                            <option value="Science-Fiction">Science-Fiction</option>
                            <option value="Policier">Policier</option>
                            <option value="Humour">Humour</option>
                            <option value="Drame">Drame</option>
                            <option value="Aventure">Aventure</option>
                            <option value="Slice of Life">Slice of Life</option>
                            <option value="Horreur">Horreur</option>
                            <option value="Historique">Historique</option>
                            <option value="Western">Western</option>
                            <!-- Add more genres -->
                        </select>
                    </div>

                     <div class="input-group">
                        <label for="style">Style Visuel Cible</label>
                        <select id="style">
                            <option value="Manga">Manga</option>
                            <option value="Franco-Belge">Franco-Belge (Ligne Claire)</option>
                            <option value="Comics US">Comics US (Super-héros)</option>
                            <option value="Réaliste">Réaliste / Peinture Numérique</option>
                            <option value="Cartoon">Cartoon / Animation</option>
                            <option value="Aquarelle">Aquarelle</option>
                            <option value="Pixel Art">Pixel Art</option>
                             <option value="Noir et Blanc">Noir et Blanc (Ink)</option>
                             <!-- Add more styles -->
                        </select>
                    </div>

                     <div class="input-group">
                        <label for="tone">Ton</label>
                        <select id="tone">
                            <option value="Épique">Épique</option>
                            <option value="Sérieux">Sérieux</option>
                            <option value="Léger / Humoristique">Léger / Humoristique</option>
                            <option value="Sombre / Mature">Sombre / Mature</option>
                            <option value="Mystérieux">Mystérieux</option>
                            <option value="Poétique">Poétique</option>
                            <option value="Satirique">Satirique</option>
                            <option value="Action">Action</option>
                            <!-- Add more tones -->
                        </select>
                    </div>
                </div>

                 <div class="input-group">
                    <label for="details">Détails Optionnels (Personnages principaux, Univers, Éléments clés)</label>
                    <textarea id="details" placeholder="Ex: Capitaine Moustache (chat roux borgne), Second Patte-de-Velours (chat noir agile). Vaisseau: Le Sardine Volante. Cherchent la planète Catlantic." rows="4"></textarea>
                </div>

                <button class="btn btn-primary" id="generate-scenario">Générer le Scénario</button>

                <div id="loading-indicator">
                    <div class="spinner"></div>
                    <p>Génération en cours via l'API...</p>
                </div>
            </div>

            <!-- Tab 2: Scenario -->
            <div class="tab-content" id="scenario-content">
                <h3>Votre Scénario</h3>
                <div id="scenario-output">
                    <p>Générez d'abord un scénario depuis l'onglet "Idée & Options".</p>
                    <!-- Scenario content will be loaded here -->
                </div>

                <div class="app-controls" id="scenario-controls">
                    <button class="btn btn-success" id="approve-scenario">Approuver le Scénario</button>
                    <button class="btn btn-primary" id="modify-scenario-request">Demander Modifications</button>
                    <button class="btn btn-danger" id="regenerate-scenario">Régénérer Scénario</button>
                </div>
                <div class="modification-area" id="scenario-modification-area">
                    <label for="scenario-modification-input">Décrivez les modifications souhaitées :</label>
                    <textarea id="scenario-modification-input"></textarea>
                    <button class="btn btn-primary" id="submit-scenario-modification">Soumettre Modification</button>
                </div>
            </div>

            <!-- Tab 3: Storyboard -->
            <div class="tab-content" id="storyboard-content">
                <h3>Votre Storyboard (Bientôt Disponible)</h3>
                 <!--
                 <div class="chapter-selector">
                     <label for="storyboard-chapter-select">Choisir le chapitre :</label>
                     <select id="storyboard-chapter-select" disabled>
                         <option>Approuvez d'abord le scénario</option>
                     </select>
                 </div>
                <div id="storyboard-output">
                    <p>Approuvez d'abord le scénario pour générer le storyboard.</p>
                </div>
                 <div class="app-controls" id="storyboard-controls">
                    <button class="btn btn-success" id="approve-storyboard-chapter">Approuver Storyboard Chapitre</button>
                    <button class="btn btn-primary" id="modify-storyboard-request">Demander Modifications Chapitre</button>
                    <button class="btn btn-danger" id="regenerate-storyboard-chapter">Régénérer Storyboard Chapitre</button>
                </div>
                 <div class="modification-area" id="storyboard-modification-area">
                    <label for="storyboard-modification-input">Décrivez les modifications souhaitées pour ce chapitre :</label>
                    <textarea id="storyboard-modification-input"></textarea>
                    <button class="btn btn-primary" id="submit-storyboard-modification">Soumettre Modification</button>
                </div>
                -->
                 <p>La fonctionnalité de génération de storyboard sera ajoutée prochainement, une fois la génération de scénario via l'API stabilisée.</p>
            </div>

            <!-- Tab 4: Prompts -->
            <div class="tab-content" id="prompts-content">
                <h3>Vos Prompts Midjourney (Bientôt Disponible)</h3>
                <!--
                 <div class="chapter-selector">
                     <label for="prompts-chapter-select">Choisir le chapitre :</label>
                     <select id="prompts-chapter-select" disabled>
                         <option>Approuvez d'abord le storyboard</option>
                     </select>
                 </div>
                <div id="prompts-output">
                    <p>Approuvez d'abord le storyboard d'un chapitre pour générer les prompts.</p>
                </div>
                -->
                 <p>La fonctionnalité de génération de prompts sera ajoutée prochainement, après l'implémentation du storyboard.</p>
            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <p>© 2025 BD Creator. Tous droits réservés.</p>
            <div class="social-links">
                <a href="#"><i class="fab fa-facebook"></i></a>
                <a href="#"><i class="fab fa-twitter"></i></a>
                <a href="#"><i class="fab fa-instagram"></i></a>
                <a href="#"><i class="fab fa-youtube"></i></a>
            </div>
            <div class="footer-links">
                <a href="#">À propos</a>
                <a href="#">Confidentialité</a>
                <a href="#">Conditions d'utilisation</a>
                <a href="#">Contact</a>
                <a href="#" id="create-website-btn">Créer mon site web</a>
            </div>
        </div>
    </footer>

    <!-- No external JS libraries needed for generation anymore -->
    <!-- Inline script for UI interactions and workflow management -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- DOM Elements ---
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            const loadingIndicator = document.getElementById('loading-indicator');
            const keywordsInput = document.getElementById('keywords');
            const genreSelect = document.getElementById('genre');
            const styleSelect = document.getElementById('style');
            const toneSelect = document.getElementById('tone');
            const detailsInput = document.getElementById('details');
            const generateScenarioBtn = document.getElementById('generate-scenario');

            const scenarioOutput = document.getElementById('scenario-output');
            const scenarioControls = document.getElementById('scenario-controls');
            const approveScenarioBtn = document.getElementById('approve-scenario');
            const modifyScenarioRequestBtn = document.getElementById('modify-scenario-request');
            const regenerateScenarioBtn = document.getElementById('regenerate-scenario');
            const scenarioModificationArea = document.getElementById('scenario-modification-area');
            const scenarioModificationInput = document.getElementById('scenario-modification-input');
            const submitScenarioModificationBtn = document.getElementById('submit-scenario-modification');

            const storyboardChapterSelect = document.getElementById('storyboard-chapter-select');
            const storyboardOutput = document.getElementById('storyboard-output');
            const storyboardControls = document.getElementById('storyboard-controls');
            const approveStoryboardChapterBtn = document.getElementById('approve-storyboard-chapter');
            // ... (add buttons for storyboard modification/regeneration - currently commented out in HTML)

            const promptsChapterSelect = document.getElementById('prompts-chapter-select');
            const promptsOutput = document.getElementById('prompts-output');

            const progressSteps = {
                idea: document.getElementById('step-idea'),
                scenario: document.getElementById('step-scenario'),
                storyboard: document.getElementById('step-storyboard'),
                prompts: document.getElementById('step-prompts'),
            };

            const tabs = {
                home: document.querySelector('[data-tab="home"]'),
                scenario: document.querySelector('[data-tab="scenario"]'),
                storyboard: document.querySelector('[data-tab="storyboard"]'),
                prompts: document.querySelector('[data-tab="prompts"]'),
            }

            // --- Application State ---
            let appState = {
                currentStep: 'idea', // idea, scenario_generated, scenario_approved, storyboard_chapter_approved, prompts_generated
                scenarioData: null, // Will hold the structured scenario object
                storyboardData: {}, // Keyed by chapter index - Not used yet
                promptsData: {},    // Keyed by chapter index - Not used yet
                approvedChapters: [], // List of approved chapter indices - Not used yet
                keywords: '',
                genre: '',
                style: '',
                tone: '',
                details: '',
                activeTab: 'home'
            };

            // --- PARSER FUNCTION (Moved Inline) ---
             /**
             * Improved text parser using a line-by-line approach.
             */
             function parseScenarioTextImproved(text) {
                 console.log("Attempting improved parsing...");
                 const scenario = {
                     title: "Titre Non Défini",
                     synopsis: "",
                     chapters: []
                 };
                 let currentChapter = null;
                 let currentPage = null;
                 let currentPanel = null;
                 let readingSynopsis = false;

                 // Handle potential ```json ... ``` blocks if the API returns markdown
                 if (text.startsWith('```json')) {
                    text = text.substring(7, text.length - 3).trim();
                    try {
                        // Attempt to parse directly if it looks like JSON
                        const jsonData = JSON.parse(text);
                        console.log("Parsed directly from JSON block");
                        // You might need to adapt jsonData structure to your scenario object structure here
                        // For now, let's assume it roughly matches or fallback to line parser
                        if (jsonData.title && Array.isArray(jsonData.chapters)) {
                            return jsonData; // Adapt this if structure differs
                        }
                    } catch (e) {
                        console.warn("Could not parse JSON block directly, falling back to line parser.", e);
                        // Continue with line parser below
                    }
                 }
                  // Handle potential ``` ... ``` blocks (generic markdown code block)
                  else if (text.startsWith('```')) {
                       text = text.substring(3, text.length - 3).trim();
                  }


                 const lines = text.split('\n');

                 for (const rawLine of lines) {
                     const line = rawLine.trim();
                     if (line.length === 0) continue;

                     // Title (Case-insensitive, check variations)
                     if (line.toUpperCase().startsWith("TITRE :") || line.toUpperCase().startsWith("TITRE:")) {
                         scenario.title = line.substring(line.indexOf(':') + 1).trim();
                         readingSynopsis = false;
                         console.log("Parsed Title:", scenario.title);
                         continue;
                     }

                     // Synopsis Start (Case-insensitive, check variations)
                      if (line.toUpperCase().startsWith("SYNOPSIS :") || line.toUpperCase().startsWith("SYNOPSIS:")) {
                         scenario.synopsis = line.substring(line.indexOf(':') + 1).trim();
                         readingSynopsis = true; // Start reading synopsis lines
                          // Check if synopsis content is on the same line
                         if (scenario.synopsis.length === 0) {
                              // Content likely starts on the next line
                         } else {
                              // Content is on this line, might be multi-line
                         }
                         console.log("Parsed Synopsis Start:", scenario.synopsis);
                         continue;
                     }


                     // Chapter (Case-insensitive)
                     const chapterMatch = line.match(/CHAPITRE\s+(\d+)\s*[:\-–—]\s*(.*)/i); // Added : - – — as separators
                     if (chapterMatch) {
                         currentChapter = {
                             chapterNumber: parseInt(chapterMatch[1]),
                             title: chapterMatch[2].trim(),
                             pages: []
                         };
                         scenario.chapters.push(currentChapter);
                         currentPage = null;
                         currentPanel = null;
                         readingSynopsis = false; // Stop reading synopsis
                         console.log("Parsed Chapter:", currentChapter.title);
                         continue;
                     }

                      // If we are potentially reading multi-line synopsis and line is not a new section
                     if (readingSynopsis && !line.toUpperCase().startsWith("CHAPITRE")) {
                         scenario.synopsis += (scenario.synopsis.length > 0 ? "\n" : "") + line; // Append line to synopsis
                         continue;
                     }


                     // Must be inside a chapter to parse pages/panels
                     if (!currentChapter) continue;

                     // Page (Case-insensitive)
                     const pageMatch = line.match(/PAGE\s+(\d+)\s*[:\-–—]/i); // Added : - – —
                     if (pageMatch) {
                         currentPage = {
                             pageNumber: parseInt(pageMatch[1]),
                             panels: []
                         };
                         // Avoid duplicate pages if model repeats headers
                         if (!currentChapter.pages.some(p => p.pageNumber === currentPage.pageNumber)) {
                             currentChapter.pages.push(currentPage);
                             currentPanel = null;
                             console.log("Parsed Page:", currentPage.pageNumber);
                         } else {
                              console.warn(`Duplicate page header ignored: Page ${currentPage.pageNumber}`);
                              currentPage = currentChapter.pages.find(p => p.pageNumber === currentPage.pageNumber); // Use existing page
                         }
                         continue;
                     }

                     // Must be inside a page to parse panels
                     if (!currentPage) continue;

                     // Panel / Case (Case-insensitive, more flexible)
                      // Try matching "Case X:" or "Panel X:" or just "X:" if previous line was a Page header
                     const panelMatchSimple = line.match(/(?:Case|Panel|Case)\s*(\d+)\s*[:\-–—]\s*(.*)/i);
                      // Basic attempt to catch just "X. Description" or "X) Description"
                     const panelMatchAlt = line.match(/^(\d+)[.)]\s+(.*)/);

                     let panelNumber = null;
                     let panelText = null;

                     if (panelMatchSimple) {
                          panelNumber = parseInt(panelMatchSimple[1]);
                          panelText = panelMatchSimple[2].trim();
                     } else if (panelMatchAlt) {
                          panelNumber = parseInt(panelMatchAlt[1]);
                          panelText = panelMatchAlt[2].trim();
                          // Heuristic: Only treat as new panel if number is 1 or follows previous panel number
                          if (currentPage.panels.length > 0 && panelNumber !== currentPage.panels[currentPage.panels.length - 1].panelNumber + 1) {
                               panelNumber = null; // Don't treat as new panel, likely part of description
                          }
                     }


                     if (panelNumber !== null && panelText !== null) {
                         // Try to extract Dialogue/Thoughts from the panelText
                         let description = panelText;
                         let dialogue = null;
                         let thoughts = null;

                         // More robust dialogue extraction (check different quotes)
                         const dialogueMatch = description.match(/(?:Dialogue|Dialogues)\s*[:\-–—]?\s*["«]([^"»]+)["»]/i);
                         if (dialogueMatch) {
                             dialogue = dialogueMatch[1].trim();
                             description = description.replace(dialogueMatch[0], '').trim(); // Remove dialogue part
                         }

                         // More robust thoughts extraction
                         const thoughtsMatch = description.match(/(?:Pensées|Pensée)\s*[:\-–—]?\s*[\(]([^\)]+)[\)]/i);
                          if (thoughtsMatch) {
                              thoughts = thoughtsMatch[1].trim();
                              description = description.replace(thoughtsMatch[0], '').trim(); // Remove thoughts part
                          }

                         // Remove potential empty separators left over
                         description = description.replace(/^(?:Dialogue|Pensées)\s*[:\-–—]?\s*/i, '').trim();

                         currentPanel = {
                             panelNumber: panelNumber,
                             description: description.trim(),
                             dialogue: dialogue,
                             thoughts: thoughts
                         };
                          // Avoid duplicate panels
                         if (!currentPage.panels.some(p => p.panelNumber === currentPanel.panelNumber)) {
                             currentPage.panels.push(currentPanel);
                              // console.log(`Parsed Panel ${currentPanel.panelNumber}: Desc='${currentPanel.description.substring(0,30)}...'`);
                         } else {
                              console.warn(`Duplicate panel header ignored: Panel ${currentPanel.panelNumber}`);
                              // Append description to existing panel maybe?
                              let existingPanel = currentPage.panels.find(p => p.panelNumber === currentPanel.panelNumber);
                              if (existingPanel && currentPanel.description) {
                                   existingPanel.description += "\n" + currentPanel.description;
                              }
                         }
                         continue; // Move to next line after processing a panel header
                     }

                     // --- Append to last panel's description ---
                     // If the line doesn't match a new structure element AND we have a current panel,
                     // append it to the description of the last panel.
                     if (currentPanel && line.length > 0) {
                           // Append non-structural lines to the description of the current panel
                           if (currentPanel.description.length > 0) {
                                currentPanel.description += "\n" + line;
                           } else {
                                currentPanel.description = line;
                           }
                     } else if (currentPage && line.length > 5) {
                         // Or maybe it's context for the page before the first panel? Add as page context?
                         // For now, log as orphan line if no current panel exists on the page
                          // console.log(`Orphan line on page ${currentPage.pageNumber}:`, line);
                     }
                 }
                 console.log("Parsing finished.");
                 return scenario;
             }


            // --- UI Update Functions (Keep existing updateUI, displayStoryboardChapter, displayPromptsChapter, updateChapterSelect) ---
             // Adjusted displayScenario to handle parsing failures better
             function displayScenario(scenario) {
                 if (!scenario || typeof scenario !== 'object' || !scenario.title) {
                     scenarioOutput.innerHTML = '<p class="text-danger">Erreur : Le format du scénario reçu est invalide.</p>';
                     console.error("Invalid scenario structure received:", scenario);
                     return;
                 }

                let html = `<h3>${scenario.title}</h3>`;

                 // Check if parsing failed (indicated by rawContent in the first chapter)
                 if (scenario.chapters && scenario.chapters.length > 0 && scenario.chapters[0].rawContent) {
                      html += `<div class="scenario-section"><h4>Synopsis</h4><p>${scenario.synopsis || "Synopsis Non Trouvé"}</p></div>`;
                      html += `<div class="scenario-chapter"><h4>${scenario.chapters[0].title || "Chapitre 1"}</h4>`;
                      html += `<p class="text-danger"><strong>Erreur de Structuration :</strong> L'IA n'a pas suivi le format attendu, ou le format n'a pas pu être analysé correctement. Voici le texte brut reçu :</p>`;
                      html += `<pre style="white-space: pre-wrap; background-color: #eee; padding: 10px; border-radius: 4px; max-height: 400px; overflow-y: auto;">${scenario.chapters[0].rawContent}</pre>`;
                      html += `</div>`;
                      scenarioOutput.innerHTML = html;
                      console.warn("Displaying raw content due to parsing failure detected.");
                      return; // Stop further processing
                 }

                 // --- Original display logic if parsing seems successful ---
                if(scenario.synopsis) {
                     html += `<div class="scenario-section"><h4>Synopsis</h4><p>${scenario.synopsis.replace(/\n/g, '<br>')}</p></div>`;
                }

                 if (!Array.isArray(scenario.chapters) || scenario.chapters.length === 0) {
                      html += "<p><em>Aucun chapitre n'a pu être extrait du scénario.</em></p>";
                 } else {
                     scenario.chapters.forEach((chapter, index) => {
                         // Use chapterNumber if available, otherwise use index
                         const chapterNumDisplay = chapter.chapterNumber ? `Chapitre ${chapter.chapterNumber}` : `Chapitre ${index + 1}`;
                         html += `<div class="scenario-chapter"><h4>${chapterNumDisplay}: ${chapter.title || 'Sans titre'}</h4>`;

                         if (Array.isArray(chapter.pages) && chapter.pages.length > 0) {
                              chapter.pages.forEach(page => {
                                   html += `<div class="scenario-page"><h5>Page ${page.pageNumber}</h5>`;
                                   if(Array.isArray(page.panels) && page.panels.length > 0) {
                                        page.panels.forEach(panel => {
                                             html += `<div class="scenario-panel"><strong>Case ${panel.panelNumber}:</strong> `;
                                             html += `<em>${(panel.description || 'Pas de description.').replace(/\n/g, '<br>')}</em>`; // Added line break conversion
                                             if(panel.dialogue) {
                                                  html += `<br>Dialogue: "${panel.dialogue}"`;
                                             }
                                              if(panel.thoughts) {
                                                   html += `<br>Pensées: (${panel.thoughts})`;
                                              }
                                             html += `</div>`;
                                        });
                                   } else {
                                        html += "<p><em>Aucune case trouvée pour cette page.</em></p>";
                                   }
                                   html += `</div>`; // Close scenario-page
                              });
                         } else {
                              html += `<p><em>Aucune page ou case détaillée n'a pu être extraite pour ce chapitre.</em></p>`;
                         }
                         html += `</div>`; // Close scenario-chapter
                     });
                 }
                 scenarioOutput.innerHTML = html;
            }
             // ... (keep other UI functions: updateChapterSelect, displayStoryboardChapter, displayPromptsChapter) ...
             function updateChapterSelect(selectElement, type) {
                 selectElement.innerHTML = ''; // Clear existing options
                 if (!appState.scenarioData || !Array.isArray(appState.scenarioData.chapters) || (appState.scenarioData.chapters[0] && appState.scenarioData.chapters[0].rawContent)) { // Added check for rawContent
                     const defaultOption = document.createElement('option');
                     if (type === 'storyboard') defaultOption.textContent = 'Générez un scénario valide';
                     else defaultOption.textContent = 'Approuvez un scénario valide';
                     selectElement.appendChild(defaultOption);
                     selectElement.disabled = true;
                     return;
                 }
                 // ... (rest of the function remains the same) ...
                  if (type === 'prompts' && appState.approvedChapters.length === 0) {
                     const defaultOption = document.createElement('option');
                     defaultOption.textContent = 'Approuvez d\'abord un storyboard';
                     selectElement.appendChild(defaultOption);
                     selectElement.disabled = true;
                     return;
                 }

                 appState.scenarioData.chapters.forEach((chapter, index) => {
                     if (type === 'prompts' && !appState.approvedChapters.includes(index)) {
                         return;
                     }
                     const option = document.createElement('option');
                     option.value = index;
                      // Use chapterNumber if available, otherwise use index
                     const chapterNumDisplay = chapter.chapterNumber ? `Chapitre ${chapter.chapterNumber}` : `Chapitre ${index + 1}`;
                     option.textContent = `${chapterNumDisplay}: ${chapter.title || 'Sans titre'}`;
                      if (appState.approvedChapters.includes(index)) {
                          option.textContent += " (Storyboard Approuvé)";
                      }
                     selectElement.appendChild(option);
                 });

                 selectElement.disabled = selectElement.options.length === 0;

             }
             function displayStoryboardChapter(chapterIndex) {
                // This function will need implementation later
                 storyboardOutput.innerHTML = `<p>Affichage du storyboard pour Chapitre ${chapterIndex + 1} (Fonctionnalité à implémenter).</p>`;
             }
             function displayPromptsChapter(chapterIndex) {
                 // This function will need implementation later
                 promptsOutput.innerHTML = `<p>Affichage des prompts pour Chapitre ${chapterIndex + 1} (Fonctionnalité à implémenter).</p>`;
             }


            // --- Function to call the Netlify backend ---
            async function handleGenerateScenario() {
                appState.keywords = keywordsInput.value.trim();
                appState.genre = genreSelect.value;
                appState.style = styleSelect.value;
                appState.tone = toneSelect.value;
                appState.details = detailsInput.value.trim();

                if (!appState.keywords) {
                    alert('Veuillez entrer une idée initiale (mots-clés, phrase...).');
                    return;
                }

                loadingIndicator.style.display = 'block';
                generateScenarioBtn.disabled = true;
                scenarioOutput.innerHTML = '<p>Envoi de la requête à l\'IA via le serveur...</p>';

                const requestData = {
                    keywords: appState.keywords,
                    genre: appState.genre,
                    style: appState.style,
                    tone: appState.tone,
                    details: appState.details
                };

                try {
                    const response = await fetch('/.netlify/functions/generate-story', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json', },
                        body: JSON.stringify(requestData),
                    });

                    if (!response.ok) {
                        let errorMsg = `Erreur HTTP: ${response.status} ${response.statusText}`;
                        try {
                             const errorBody = await response.json();
                             errorMsg += ` - ${errorBody.error || 'Erreur inconnue du serveur.'} ${errorBody.details ? `(${errorBody.details})` : ''}`;
                        } catch(e) { /* Ignore */ }
                        throw new Error(errorMsg);
                    }

                    const result = await response.json();

                    if (result.scenarioText) {
                        console.log("Raw scenario text received from backend:", result.scenarioText.substring(0, 200) + "...");
                        appState.scenarioData = parseScenarioTextImproved(result.scenarioText);
                         console.log("Parsed scenario data:", appState.scenarioData);

                         // Check parsing success again after parsing
                         if (!appState.scenarioData.title || appState.scenarioData.title === "Titre Non Défini" || !appState.scenarioData.chapters || appState.scenarioData.chapters.length === 0 || (appState.scenarioData.chapters[0] && !appState.scenarioData.chapters[0].rawContent && appState.scenarioData.chapters[0].pages.length === 0) ) {
                             console.warn("Parsing failed after receiving data from backend. Preparing raw content display object.");
                              if (!appState.scenarioData.chapters || appState.scenarioData.chapters.length === 0) {
                                  // If parsing totally failed, create minimal structure with raw content
                                   appState.scenarioData = { title: appState.scenarioData.title || "Titre Non Trouvé (Parsing Échoué)", synopsis: "N/A", chapters: [{ chapterNumber: 1, title: "Erreur de Structuration (depuis API)", pages: [], rawContent: result.scenarioText }] };
                              } else if (appState.scenarioData.chapters[0]) {
                                   // If parsing started but failed, add raw content info to first chapter
                                   appState.scenarioData.chapters[0].title += " (Erreur de Structuration)";
                                   appState.scenarioData.chapters[0].rawContent = result.scenarioText; // Ensure rawContent is set
                              }
                         }

                        appState.currentStep = 'scenario_generated';
                        appState.activeTab = 'scenario';
                        appState.storyboardData = {};
                        appState.promptsData = {};
                        appState.approvedChapters = [];

                    } else if (result.error) {
                         throw new Error(`Erreur de l'API: ${result.error} ${result.details ? `(${result.details})` : ''}`);
                    } else {
                         throw new Error("Réponse inattendue du serveur.");
                    }

                } catch (error) {
                    console.error("Error in handleGenerateScenario fetch:", error);
                    scenarioOutput.innerHTML = `<p class="text-danger">Erreur lors de la génération du scénario : ${error.message}. Vérifiez la console du navigateur et les logs de la fonction Netlify.</p>`;
                    // Reset scenario data on error to avoid inconsistent state
                    appState.scenarioData = null;
                    appState.currentStep = 'idea';
                } finally {
                    loadingIndicator.style.display = 'none';
                    generateScenarioBtn.disabled = false;
                    updateUI();
                }
            }

             // --- Other Event Handlers (Keep existing logic for now) ---
            function handleApproveScenario() {
                // Check if scenario data is valid and not showing raw content due to error
                if (!appState.scenarioData || (appState.scenarioData.chapters && appState.scenarioData.chapters[0] && appState.scenarioData.chapters[0].rawContent)) {
                    alert("Impossible d'approuver un scénario qui n'a pas été généré ou structuré correctement.");
                    return;
                }
                appState.currentStep = 'scenario_approved';
                appState.activeTab = 'storyboard'; // Move to storyboard tab (which currently says 'Bientôt')
                updateUI();
                 // // Future: Automatically select the first chapter for storyboard generation
                 // if (storyboardChapterSelect.options.length > 0) {
                 //     storyboardChapterSelect.selectedIndex = 0;
                 //     storyboardChapterSelect.dispatchEvent(new Event('change'));
                 // }
            }

            function handleModifyScenarioRequest() {
                 scenarioModificationArea.style.display = 'block';
                 scenarioControls.style.display = 'none';
            }

            async function handleSubmitScenarioModification() {
                 const modificationRequest = scenarioModificationInput.value.trim();
                 if (!modificationRequest) {
                     alert("Veuillez décrire les modifications souhaitées.");
                     return;
                 }
                 alert("Fonctionnalité de modification non implémentée dans cette version.\nCeci nécessiterait un autre appel à la fonction Netlify avec le scénario actuel et la demande.");
                  // Reset UI
                  scenarioModificationArea.style.display = 'none';
                  updateUI(); // Show controls again
            }

            function handleRegenerateScenario() {
                 if (confirm("Êtes-vous sûr de vouloir régénérer le scénario ? Le scénario actuel sera perdu.")) {
                      // Simply call the generation function again with the same inputs
                      handleGenerateScenario();
                 }
            }

             async function handleGenerateStoryboardChapter(event) {
                 alert("La génération de storyboard n'est pas encore implémentée.");
                 // const targetButton = event.target;
                 // const chapterIndex = parseInt(targetButton.getAttribute('data-chapter'));
                 // ... (future implementation using another Netlify function) ...
             }

            function handleApproveStoryboardChapter() {
                 alert("L'approbation de storyboard n'est pas encore fonctionnelle.");
                // const selectedChapterIndex = parseInt(storyboardChapterSelect.value);
                // ... (future implementation) ...
            }

             async function handleGeneratePromptsChapter(event) {
                 alert("La génération de prompts n'est pas encore implémentée.");
                 // const targetButton = event.target;
                 // const chapterIndex = parseInt(targetButton.getAttribute('data-chapter'));
                 // ... (future implementation using another Netlify function) ...
             }

            // --- Event Listeners Setup ---
            tabBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    if (this.classList.contains('disabled')) return;
                    appState.activeTab = this.getAttribute('data-tab');
                    updateUI();
                });
            });

            generateScenarioBtn.addEventListener('click', handleGenerateScenario);
            approveScenarioBtn.addEventListener('click', handleApproveScenario);
            modifyScenarioRequestBtn.addEventListener('click', handleModifyScenarioRequest);
            submitScenarioModificationBtn.addEventListener('click', handleSubmitScenarioModification);
             regenerateScenarioBtn.addEventListener('click', handleRegenerateScenario); // Added listener

             // --- Commented out listeners for future features ---
             // storyboardChapterSelect.addEventListener('change', function() { updateUI(); });
             // approveStoryboardChapterBtn.addEventListener('click', handleApproveStoryboardChapter);
             // promptsChapterSelect.addEventListener('change', function() { updateUI(); });

             // --- Session Management Listeners (Keep existing) ---
             document.getElementById('new-session').addEventListener('click', function() {
                 if (confirm('Êtes-vous sûr de vouloir créer une nouvelle session ? Toutes les données non sauvegardées seront perdues.')) {
                      appState = {
                          currentStep: 'idea', scenarioData: null, storyboardData: {}, promptsData: {}, approvedChapters: [],
                          keywords: '', genre: '', style: '', tone: '', details: '', activeTab: 'home'
                      };
                      keywordsInput.value = '';
                      genreSelect.selectedIndex = 0;
                      styleSelect.selectedIndex = 0;
                      toneSelect.selectedIndex = 0;
                      detailsInput.value = '';
                      scenarioOutput.innerHTML = '<p>Générez d\'abord un scénario...</p>';
                      storyboardOutput.innerHTML = '<p>Approuvez d\'abord le scénario...</p>';
                      promptsOutput.innerHTML = '<p>Approuvez d\'abord le storyboard...</p>';
                      updateUI();
                 }
             });

            document.getElementById('save-session').addEventListener('click', function() {
                const sessionData = {
                    inputs: {
                        keywords: keywordsInput.value,
                        genre: genreSelect.value,
                        style: styleSelect.value,
                        tone: toneSelect.value,
                        details: detailsInput.value
                    },
                    state: appState
                };
                const sessionName = prompt('Donnez un nom à cette session:');
                if (sessionName) {
                    try {
                         // Basic check for potentially huge data (scenario can be large)
                         if (JSON.stringify(sessionData).length > 4 * 1024 * 1024) { // ~4MB limit warning
                              alert("Attention : La session est très volumineuse, la sauvegarde pourrait échouer ou ralentir le navigateur.");
                         }
                         localStorage.setItem(`bdcreator_session_${sessionName}`, JSON.stringify(sessionData));
                         alert(`Session "${sessionName}" sauvegardée avec succès!`);
                    } catch (e) {
                         alert(`Erreur lors de la sauvegarde: ${e.message}. L'espace de stockage local est peut-être plein.`);
                         console.error("Local storage save error:", e);
                    }
                }
            });

             document.getElementById('load-session').addEventListener('click', function() {
                 const sessions = [];
                 try {
                     for (let i = 0; i < localStorage.length; i++) {
                         const key = localStorage.key(i);
                         if (key && key.startsWith('bdcreator_session_')) {
                             sessions.push(key.replace('bdcreator_session_', ''));
                         }
                     }
                 } catch(e) {
                      alert("Erreur d'accès au stockage local.");
                      console.error("Error accessing local storage keys:", e);
                      return;
                 }


                 if (sessions.length === 0) {
                     alert('Aucune session sauvegardée trouvée.');
                     return;
                 }

                 const sessionName = prompt(`Choisissez une session à charger (${sessions.join(', ')}):`, sessions[0]);
                 if (sessionName && sessions.includes(sessionName)) {
                     try {
                          const sessionString = localStorage.getItem(`bdcreator_session_${sessionName}`);
                          if (!sessionString) throw new Error("Données de session non trouvées.");

                          const sessionData = JSON.parse(sessionString);
                          if (!sessionData || !sessionData.inputs || !sessionData.state) throw new Error("Format de session invalide.");

                          // Restore inputs
                          keywordsInput.value = sessionData.inputs.keywords || '';
                          genreSelect.value = sessionData.inputs.genre || 'Fantastique';
                          styleSelect.value = sessionData.inputs.style || 'Manga';
                          toneSelect.value = sessionData.inputs.tone || 'Épique';
                          detailsInput.value = sessionData.inputs.details || '';

                          // Restore state
                          appState = sessionData.state;

                          alert(`Session "${sessionName}" chargée avec succès!`);
                          updateUI(); // Update UI with loaded state
                     } catch (e) {
                          alert(`Erreur lors du chargement de la session "${sessionName}": ${e.message}`);
                          console.error("Load session error:", e);
                          // Optionally clear broken session data
                          // localStorage.removeItem(`bdcreator_session_${sessionName}`);
                     }
                 }
             });


            // Footer link placeholder
            document.getElementById('create-website-btn').addEventListener('click', function(e) {
                e.preventDefault();
                alert('Cette fonctionnalité externe n\'est pas disponible.');
            });

            // --- Initial UI Setup ---
            updateUI();

        });
    </script>

</body>
</html>